---
title: Java面向对象——多态性
date: 2021/5/4
tags: [多态性]
categories: Java
---

## Java 面向对象——多态性

### 多态性的理解

- 多态性可以理解为一个事物的多种形态
- 对象的多态性：父类的引用指向子类的对象（子类的对象赋给父类），假设 Man 继承于 Person
- `Person p1 = new Man();`

### 多态的使用

- 当调用子父类同名同参数的方法时，实际执行的是子类重写父类的方法--虚拟方法调用
  - 注意虚拟方法调用在编译期是无法确定的
- 编译期：只能调用父类中声明的方法，即不能调用子类独有的属性和方法，执行期执行的是子类重写父类的方法
- 总结：`编译看左边，运行看右边`
- 对象多态性只适用于方法，不适用于属性

```java
Person P1 = new Man();
P1.eat();//调用的是Man类重写了Person类的eat方法
```

- 作用：提高了代码的通用性，常称为接口重用

### 多态性的使用前提

- 需要存在类的继承关系
- 有方法的重写

### 向下转型的使用

- `Person p1 = new Man();`向上转型（多态）
- 有了对象的多态性以后，内存中实际上是加载了子类特有的属性和方法，但是由于变量声明为父类类型，导致编译时，只能调用父类中声明的属性和方法，子类特有的属性方法不能调用，那如何才能调用子类特有的属性和方法？
- 使用强制类型转换符

```java
Person p1 = new Man();
Man p2 = (Man)p1;
```

### 对象类型转换 Casting

- 基本数据类型转换
  - 自动类型转换：小的数据类型可以自动转换为大的数据类型
  - 例如：`long g = 20`
  - 强制类型转换：可以用大的数据类型强制转换成小的数据类型
  - 例如：`float f = (float)12.0`
- 对 Java 对象的强制类型转换称为<span style="color:red"> 造型 </span>
  - 从子类到父类的类型转换可以自动进行
  - 从父类到子类的类型转换必须通过造型（强制类型转换）实现
  - 无继承关系的引用类型间的转换是非法的
  - 为了避免强制转型时出错，在造型前可以使用 instanceOf 来检验一个对象的类型

### instanceOf 关键字的使用

- `x instanceOf A`：检验 x 是否为类 A 的对象，返回值为 Boolean 类型
- x 为实例化的对象
- 要求 x 所属的类与类 A 必须是子类和父类的关系，否则编译错误
- 如果 x 属于类 A 的子类 B，`x instanceOf A` 的值也为 true

### ==符与 equals 方法

- ==符：
  - 基本类型比较值：只要两个变量的值相等，即为 true，需保证==符号两边的变量类型一致
  - 例：`int a = 5; if(a == 6){...}`
  - 引用类型比较引用（是否指向同一个对象）：只有指向同一个对象时，==才返回 true
- equals：

  - Object 类中定义的 equals 方法和==作用是相同的，比较引用值是否相等
  - 所有类都继承了 Object，也就获得了 equals（）方法，还可以重写
  - 只能比较引用类型，其作用与`==`相同，比较是否指向同一个对象
  - 格式：`obj1.equals(obj2);`
  - 特例：当用 equals 方法进行比较时，对类 File、String、Date 及包装类来说，是比较类型及内容是否相同而不考虑引用的是否是同一个对象
    - 原因，在这些类中重写了 Object 类的 equels 方法
  - 任何情况下，`x.equals(null)`，永远返回是“false”； `x.equals(和 x 不同类型的对象)`永远返回是“false”
  - 自定义类重写 equals 方法，即让其比较两个对象的实体内容是否相同而不是比较两者的引用值
  - ```java
    @override
    public boolean equals(Object obj){
        if(this == obj){
          return true;
        }
        if(obj instanceOf XXX){
          XXX x = (XXX)obj;
          //比较两个对象的每个属性是否相同
        }else{
          return false;
        }
    }
    ```
