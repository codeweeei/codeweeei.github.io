---
title: 移动端开发——视口详情
date: 2021/1/28
tags: [视口]
categories: 移动端开发
---

# 移动端开发——视口的缩放配置

## 一：像素的基本概念

- 像素：计算机屏幕中显示特定颜色的最小区域。屏幕中的像素越多，同一范围内能看到的内容就越多。或者说，当设备尺寸相同时，像素越密集，画面就越精细。
- 那么，当我们在 CSS 中为一个元素设置属性 `width: 200px;` 时，会发生什么？这个元素的宽度究竟是多少像素呢？
- 这里涉及两种像素：物理像素和 css 像素

### <b style="color:skyblue">1.物理像素（设备像素 device pixels）</b>：

- 指的是设备屏幕的物理像素，任何设备的物理像素都是固定的；

### <b style="color:skyblue">2.CSS 像素（CSS pixels）</b>：

- 是 CSS 和 JS 中使用的一个抽象概念。它和物理像素之间的比例取决于屏幕的特性（是否为高密度）以及用户进行的缩放，由浏览器自行换算，CSS 像素 PX 只是代表 WEB 网页中的一个度量单位，可以理解为同 rem 和 em 等单位一样，需要有一个参照尺寸才能确定其实际大小。

- 说明一下：web 开发过程中，我们基本使用的都是 CSS 像素，设备像素基本不会用。例如：`width:200px` 的元素跨越了 200 个 CSS 像素。CSS 像素相当于多少个设备像素取决于屏幕的特性（是否高密度）和用户进行的缩放。当用户放大的越大，一个 CSS 像素覆盖的设备像素就越多，因此这个元素不一定会跨越 css 设置等值的设备像素。在旧的屏幕上，当缩放程度为 100%时，一个 CSS 像素等于一个设备像素。在高密度屏幕上，例如苹果的视网膜屏幕，一个 CSS 像素跨越了多个设备像素。
- 对照下图：（红色表示 CSS 像素、蓝色表示设备像素）
  {% asset_img css像素.png css像素 %}
- 我们在开发中，操作的是 CSS 像素，让 CSS 像素去覆盖设备像素。不过当我们使用 CSS 和 JavaScript 的时候，其实并不会在意一个 CSS 像素跨越了多少个设备像素。这个依赖于屏幕特性和用户缩放程度的计算由浏览器完成。
- DPR 设备像素比（device pixel ratio）= 物理像素 / css 像素
  - 可通过 `window.devicePixelRatio` 获取到当前设备的设备像素比

## 二：三个视口

- PC 端书写 CSS 样式时直接使用 PX，不考虑适配的原因，因为电脑出厂设置默认都是 PPI = 显示屏 DPI 的，1：1 关系，即 dpr（devicePixelRatio,设备像素比 = 物理像素（即发光点）/逻辑 css 像素（px)），这是显示器的“最佳分辨率，也是我们 PX 像素比例所依赖的分辨率。

- 我们经常在开发中会使用到例如 width:35%这样的代码去布局。它表示占用父元素的百分比宽度。我们看 html 文档结构知道最外层的一层是 html 元素。那么 html 元素的包含块是什么？这就是要说得视口了。在 CSS 标准文档中，它被称为初始包含块。这个初始包含块是所有 CSS 百分比宽度推算的根源。（在桌面上，视口的宽度和浏览器窗口的宽度一致）。

### <b style="color:skyblue">1.布局视口（layout viewport）</b>

- 移动端设备如果使用视口的宽度和浏览器窗口宽度一样会导致很丑陋的结果。想象一下。一个针对桌面级的左右结构页面布局，左侧站浏览器窗口的 20%，右侧占 80%。这样的页面在我们小屏幕的移动端设备上会缩放的非常小。也许会导致大部分数据重叠覆盖，也可能导致数据遮挡无法显示全部而出现滚动条。

- 所以，移动端浏览器厂商必须保证即使在窄屏幕下我们的页面可以展示的很好，他们将视口的宽度设计得比屏幕宽度宽出很多。这样。在移动端，视口与移动端浏览器屏幕宽度就不再关联，而是完全独立的了。我们称它为 布局视口。CSS 布局会根据它来计算并被约束。
- 通过`document.documentElement.clientWidth `获得

### <b style="color:skyblue">2.视觉视口（visual viewport）</b>

- 虽然独立的布局视口很大程度上帮助了桌面网站过渡到手机上。但我们不能完全忽视移动设备上的屏幕尺寸。所以该说明一下视觉视口了。

- 视觉视口是用户正在看到的网站的区域。用户可以通过缩放来操作视觉视口，同时不会影响布局视口。布局视口还是保持在原来的宽度。
- 可通过`window.innerWidth`获得

### <b style="color:skyblue">3.理想视口（idea viewport）</b>

- 布局视口的默认宽度并不是一个理想的宽度。显然用户希望在进入页面时可以不需要缩放或拖动滚动条就可以有一个理想的浏览和阅读尺寸。理想视口仍是为移动端设备准备的。只有手动添加 meta 视口标签方才生效。如果没有 meta 视口标签，那么布局将会维持它的默认宽度（布局视口宽度）。

- 如下代码，告诉浏览器，布局视口的宽度应该与理想视口的宽度一致。（一般来讲我们都会将布局视口的宽度设为设备宽度一样，然后使用 css 媒体查询编写一套针对移动端的展示方案。）

```html
<meta
  name="viewport"
  content="width=devcice-width,initial-scale=1,maximum-scale=1,user-scalable=no"
/>
```

### <b style="color:skyblue">4.关于缩放以及 initial-scale 的默认值</b>

- 缩放是相对 idea viewport 来进行缩放的，缩放值越大，当前 viewport 的宽度就会越小，反之亦然。
- 因为当 initial-scale = 2 时，css 像素就相当设备像素放大了 2 倍，于是当前可见视口的像素就缩小一倍，所以得出公式：
- `当前缩放值 = idea viewport 宽度 / visual viewport 宽度 = css 像素 / 设备像素 = 1 / 设备像素比`

---

对于 viewport 的详细解释可以参考这篇文章：https://www.cnblogs.com/2050/p/3877280.html
